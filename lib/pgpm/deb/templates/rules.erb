#!/usr/bin/make -f

export DEB_BUILDDIR = $(CURDIR)
export PGPM_BUILDROOT = $(CURDIR)
export PG_CONFIG = $(shell /usr/bin/which pg_config)
export PGPM_EXTENSION_NAME = "<%= self.package.extension_name %>"
export PGPM_EXTENSION_VERSION = "<%= self.package.version %>"
export PGPM_INSTALL_ROOT = "$(CURDIR)/debian/<%= deb_pkg_name(pkg_type) %>"

<% if pkg_type == :versioned %>
%:
	echo " --> % rules target"

build:
	echo " --> build target"
	<%= self.package.build_steps.join("\n\t").gsub('$', '$$') %>

install: build
	mkdir -p $$PGPM_INSTALL_ROOT
	echo " --> install target"
	<%= self.package.install_steps.join("\n\t").gsub('$', '$$') %>
	chmod +x "$$DEB_BUILDDIR/prepare_artifacts.sh"
	find $$PGPM_INSTALL_ROOT -type f | sort - | sed 's|^$$PGPM_INSTALL_ROOT||' > .pgpm_before | sort
	./prepare_artifacts.sh

build-arch:
	echo " --> build-arch"

build-indep:
	echo " --> build-indep"

binary: install
	echo " --> binary"

binary-arch:
	echo " --> binary-arch"

binary-indep:
	echo " --> binary-indep"

clean:
	echo " --> clean"

<% else %>
%:
	dh $@

install:
	echo " --> INSTALL"
	chmod +x "$$DEB_BUILDDIR/install_default_control.sh"
	./install_default_control.sh
<% end %>
